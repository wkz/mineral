#!/bin/sh

set -e

mineral_work=$(dirname $(readlink -f "$0"))/..
mineral_root=${mineral_work}/..
mineral_arch=$(cat ${mineral_root}/etc/apk/arch 2>/dev/null)

if [ -n "${mineral_arch}" -a "${mineral_arch}" != $(uname -m) ]; then
    qemu="-q qemu-${mineral_arch}"
fi

exec proot ${qemu} -r ${mineral_root} -w / \
     $(cat ${mineral_work}/etc/bindings | sed -e 's/^/-b /g') \
     $@
